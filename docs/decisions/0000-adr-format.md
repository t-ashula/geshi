# ADR-0000: ADR ドキュメントフォーマットと設計ログ

## ステータス

決定

## 範囲

全体

## コンテキスト

- 重要な設計決定は、後から追跡できる形で残す必要がある
- 決定の背景や却下案が残らないと、同じ議論が再発しやすい
- ADR を肥大化させずに、判断理由を補える運用ルールが必要である

## 決定

### ADR の位置づけ

- 重要な設計決定は ADR として記録し、ADR を正本とする
- 追加の議論メモは Design log 側に分離し、ADR 本文は短く保つ

### ファイル名

- ADR の配置先をリポジトリルートの `docs/decisions/` に統一する
- ファイル名は `NNNN-kebab-case-title.md` 形式とする
  - `NNNN` は 4 桁ゼロ埋め連番
  - タイトルは英小文字の kebab-case

### ステータス語彙

- `提案` / `決定` / `却下` の 3 種を使用する
- 本文中で `決定（提案）` のように混在させず、ステータスで状態を表現する

### 必須セクション

- ステータス（`提案` / `決定` / `却下`）
- 範囲
  - この ADR によって影響を受けるパッケージの範囲（全体，各 geshi/ パッケージ, scribe api, etc.）
- コンテキスト
- 決定
- 影響

### 任意セクション

- 代替案（却下した主要案の短い理由）
- 備考（補足や例外）
- 参考資料（関連 ADR、外部仕様）

任意セクションは、必須セクションの `影響` の後に以下の順で置く

- 代替案 → 備考 → 参考資料

### ADR 間参照（リンク）の運用

- 本文中は参照名（例: `ADR-0002`）だけを書く
- 相互参照リンクは `参考資料` セクションに集約し、参照リンク形式で記述する
  - 本文・リスト側: `[ADR-0000] ADR ドキュメントフォーマットと設計ログ`
  - 参照定義側: `[ADR-0000]: ./0000-adr-format.md`

### 参考資料セクションの書式

- `参考資料` セクションの項目は、本文側で `[label]` を使って記述する
- リンク先定義は、同セクション末尾に `[label]: URL-or-path` 形式でまとめる
- 外部 URL と相対パスのどちらも同じ形式を使う

### 設計ログ (Design log)

- `docs/design-log/` に ADR と同名のファイルを作成できる
- 参考資料にリンクを置く
- ADR 本文には議論の全文や思考過程を書かない

例:

- `docs/design-log/0000-adr-format.md`

### 実装詳細の扱い

- ADR 本文には実装詳細（コード断片、SQL/DDL 等）を原則として書かない
- 必要な場合は `参考資料` の末尾に以下の付録を置いてよい
  - `付録（参考）: 決定時点のスナップショット`
- `docs/types.md` のような別ファイルで整理してもよいが、決定時点の差分が重要な場合は付録で固定化する

### 言語・書式

- 日本語を第一として作成する（英語も可）
- Markdown を基調とし、強調などのインライン装飾は最小にする

### 既存 ADR の扱い

- ステータスが `決定` または `却下` になった ADR の本文は原則として書き換えない
  - ドキュメントフォーマット調整や軽微な誤字脱字修正は許容する
  - その場合は、当該修正のみのコミットにして変更理由を明確にする
- 方針変更が必要な場合は、新しい ADR を起票し、置き換え関係は `参考資料` に記す

## 影響

- 重要決定の記録方法が統一され、後から「なぜそうしたか」を追える
- 決定の背景や却下案が最小限で記録され、再検討コストが下がる
- ADR 本文の可読性と運用性が保たれる
- フォーマット策定前に作られた ADR にも遡及適用する
